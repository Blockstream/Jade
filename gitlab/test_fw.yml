#
# Test firmware build stage
#
# Used to build test firmware images:
# - _ci images that auto-click buttons to allow running test_jade on.
# - qemu images for running the tests on qemu.
#
# These artifacts aren't released so retain them only for 2 days.
#
.build_test_template:
  extends: .build_template
  stage: build_test
  artifacts:
    expire_in: 2 days

build_test_jade_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade --dev --debug --ci --log

build_test_jade_noradio_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade --dev --debug --ci --log --noradio

build_test_jade_v1_1_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v1_1 --dev --debug --ci --log

build_test_jade_v1_1_noradio_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v1_1 --dev --debug --ci --log --noradio

build_test_jade_v2_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v2 --dev --debug --ci --log --jtag

build_test_jade_v2_noradio_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v2 --dev --debug --ci --log --jtag --noradio

build_test_jade_v2c_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v2c --dev --debug --ci --log --jtag

build_test_jade_v2c_noradio_ci:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh jade_v2c --dev --debug --ci --log --jtag --noradio

build_test_qemu:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh qemu --dev --ci

build_test_qemu_psram:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh qemu --dev --ci --psram

build_test_qemu_psram_unamalgamated:
  extends: .build_test_template
  before_script:
    - . $HOME/esp/esp-idf/export.sh && ./tools/switch_to.sh qemu --dev --ci --psram --unamalgamated
